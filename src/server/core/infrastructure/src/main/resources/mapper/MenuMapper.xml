<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mayanshe.scrmstd.infrastructure.persistence.mapper.MenuMapper">
    <!-- 菜单(menus)表映射 -->

    <insert id="insert" parameterType="com.mayanshe.scrmstd.infrastructure.persistence.po.MenuPo">
        INSERT INTO menus
        (id, parent_id, kind, name, title, path, redirect, component, icon, sort, is_external,
         external_link, keep_alive, hide_in_menu, hide_children_in_menu, requires_auth, permission,
         status, remark, created_at)
        VALUES (#{id}, #{parentId}, #{kind}, #{name}, #{title}, #{path}, #{redirect}, #{component}, #{icon}, #{sort},
                #{isExternal}, #{externalLink}, #{keepAlive}, #{hideInMenu}, #{hideChildrenInMenu}, #{requiresAuth},
                #{permission}, #{status}, #{remark}, #{createdAt})
    </insert>

    <update id="update" parameterType="com.mayanshe.scrmstd.infrastructure.persistence.po.MenuPo">
        UPDATE menus
        SET parent_id             = #{parentId},
            kind                  = #{kind},
            name                  = #{name},
            title                 = #{title},
            path                  = #{path},
            redirect              = #{redirect},
            component             = #{component},
            icon                  = #{icon},
            sort                  = #{sort},
            is_external           = #{isExternal},
            external_link         = #{externalLink},
            keep_alive            = #{keepAlive},
            hide_in_menu          = #{hideInMenu},
            hide_children_in_menu = #{hideChildrenInMenu},
            requires_auth         = #{requiresAuth},
            permission            = #{permission},
            status                = #{status},
            remark                = #{remark},
            updated_at            = #{updatedAt}
        WHERE id = #{id}
    </update>

    <delete id="delete" parameterType="java.lang.Long">
        DELETE
        FROM menus
        WHERE id = #{id}
    </delete>

    <sql id="condition">
        <where>
            <if test="parentId != null">
                AND parent_id = #{parentId}
            </if>
            <if test="kind != null">
                AND kind = #{kind}
            </if>
            <if test="keywords != null and keywords != ''">
                AND (
                name LIKE CONCAT('%', #{keywords}, '%') OR
                title LIKE CONCAT('%', #{keywords}, '%')
                )
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
        </where>
    </sql>

    <select id="count" parameterType="java.util.Map" resultType="java.lang.Long">
        SELECT COUNT(1) FROM menus
        <include refid="condition"/>
    </select>

    <select id="search" parameterType="java.util.Map" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List"/>
        FROM menus
        <include refid="condition"/>
        ORDER BY
        <choose>
            <when test="orderBy != null and orderBy != ''">
                #{orderBy}
            </when>
            <otherwise>
                id ASC
            </otherwise>
        </choose>
        <if test="offset != null and limit != null">
            LIMIT #{offset}, #{limit}
        </if>
        <if test="offset == null and limit != null">
            LIMIT #{limit}
        </if>
        <if test="offset != null and limit == null">
            LIMIT #{offset}, 18446744073709551615
        </if>
    </select>

    <select id="findIdByCondition" parameterType="java.util.Map" resultType="java.lang.Long">
        SELECT id FROM menus
        <include refid="condition"/>
        LIMIT 1
    </select>
</mapper>
